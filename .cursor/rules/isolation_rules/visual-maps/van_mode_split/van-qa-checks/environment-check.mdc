---
description: VAN QA ç¯å¢ƒéªŒè¯çš„æµç¨‹å›¾
globs: van-qa-checks/environment-check.mdc
alwaysApply: false
---
# VAN QAï¼šç¯å¢ƒéªŒè¯

> **ç®€è¿°ï¼š** æ­¤ç»„ä»¶éªŒè¯æ„å»ºç¯å¢ƒæ˜¯å¦å·²æ­£ç¡®è®¾ç½®ï¼ŒåŒ…æ‹¬æ‰€éœ€çš„å·¥å…·å’Œæƒé™ã€‚

## 3ï¸âƒ£ ç¯å¢ƒéªŒè¯æµç¨‹

```mermaid
graph TD
    Start["ç¯å¢ƒéªŒè¯"] --> CheckEnv["æ£€æŸ¥æ„å»ºç¯å¢ƒ"]
    CheckEnv --> VerifyBuildTools["éªŒè¯æ„å»ºå·¥å…·"]
    VerifyBuildTools --> ToolsStatus{"æ„å»ºå·¥å…·<br>å¯ç”¨ï¼Ÿ"}

    ToolsStatus -->|"æ˜¯"| CheckPerms["æ£€æŸ¥æƒé™<br>å’Œè®¿é—®"]
    ToolsStatus -->|"å¦"| InstallTools["å®‰è£…æ‰€éœ€çš„<br>æ„å»ºå·¥å…·"]
    InstallTools --> RetryTools["é‡è¯•éªŒè¯"]
    RetryTools --> ToolsStatus

    CheckPerms --> PermsStatus{"æƒé™<br>è¶³å¤Ÿï¼Ÿ"}
    PermsStatus -->|"æ˜¯"| EnvSuccess["ç¯å¢ƒå·²éªŒè¯<br>âœ… é€šè¿‡"]
    PermsStatus -->|"å¦"| FixPerms["ä¿®å¤æƒé™<br>é—®é¢˜"]
    FixPerms --> RetryPerms["é‡è¯•æƒé™<br>æ£€æŸ¥"]
    RetryPerms --> PermsStatus

    style Start fill:#4da6ff,stroke:#0066cc,color:white
    style EnvSuccess fill:#10b981,stroke:#059669,color:white
    style ToolsStatus fill:#f6546a,stroke:#c30052,color:white
    style PermsStatus fill:#f6546a,stroke:#c30052,color:white
```

### ç¯å¢ƒéªŒè¯å®ç°ï¼š
```powershell
# ç¤ºä¾‹ï¼šä¸º Web é¡¹ç›®éªŒè¯ç¯å¢ƒ
function Validate-Environment {
    $requiredTools = @(
        @{Name = "git"; Command = "git --version"},
        @{Name = "node"; Command = "node --version"},
        @{Name = "npm"; Command = "npm --version"}
    )

    $missingTools = @()
    $permissionIssues = @()

    # æ£€æŸ¥æ„å»ºå·¥å…·
    foreach ($tool in $requiredTools) {
        try {
            Invoke-Expression $tool.Command | Out-Null
        } catch {
            $missingTools += $tool.Name
        }
    }

    # æ£€æŸ¥é¡¹ç›®ç›®å½•çš„å†™æƒé™
    try {
        $testFile = ".__permission_test"
        New-Item -Path $testFile -ItemType File -Force | Out-Null
        Remove-Item -Path $testFile -Force
    } catch {
        $permissionIssues += "å½“å‰ç›®å½•ï¼ˆå†™æƒé™è¢«æ‹’ç»ï¼‰"
    }

    # æ£€æŸ¥ç«¯å£ 3000 æ˜¯å¦å¯ç”¨ï¼ˆå¼€å‘æœåŠ¡å™¨å¸¸ç”¨ï¼‰
    try {
        $listener = New-Object System.Net.Sockets.TcpListener([System.Net.IPAddress]::Loopback, 3000)
        $listener.Start()
        $listener.Stop()
    } catch {
        $permissionIssues += "ç«¯å£ 3000ï¼ˆå·²è¢«å ç”¨æˆ–è®¿é—®è¢«æ‹’ç»ï¼‰"
    }

    # æ˜¾ç¤ºç»“æœ
    if ($missingTools.Count -eq 0 -and $permissionIssues.Count -eq 0) {
        Write-Output "âœ… ç¯å¢ƒéªŒè¯æˆåŠŸ"
        return $true
    } else {
        if ($missingTools.Count -gt 0) {
            Write-Output "âŒ ç¼ºå¤±å·¥å…·ï¼š$($missingTools -join ', ')"
        }
        if ($permissionIssues.Count -gt 0) {
            Write-Output "âŒ æƒé™é—®é¢˜ï¼š$($permissionIssues -join ', ')"
        }
        return $false
    }
}
```

## ğŸ“‹ ç¯å¢ƒéªŒè¯æ£€æŸ¥ç‚¹

```
âœ“ æ£€æŸ¥ç‚¹ï¼šç¯å¢ƒéªŒè¯
- æ‰€æœ‰å¿…éœ€çš„æ„å»ºå·¥å…·å·²å®‰è£…ï¼Ÿ[æ˜¯/å¦]
- é¡¹ç›®ç›®å½•æƒé™è¶³å¤Ÿï¼Ÿ[æ˜¯/å¦]
- æ‰€éœ€ç«¯å£å¯ç”¨ï¼Ÿ[æ˜¯/å¦]

â†’ å¦‚æœå…¨éƒ¨ä¸ºæ˜¯ï¼šç»§ç»­æœ€å°æ„å»ºæµ‹è¯•ã€‚
â†’ å¦‚æœæœ‰å¦ï¼šç»§ç»­å‰è¯·ä¿®å¤ç¯å¢ƒé—®é¢˜ã€‚
```

**ä¸‹ä¸€æ­¥ï¼ˆé€šè¿‡æ—¶ï¼‰ï¼š** åŠ è½½ `van-qa-checks/build-test.mdc`ã€‚
**ä¸‹ä¸€æ­¥ï¼ˆå¤±è´¥æ—¶ï¼‰ï¼š** æŸ¥çœ‹ `van-qa-utils/common-fixes.mdc` è·å–ç¯å¢ƒä¿®å¤æ–¹æ³•ã€‚
