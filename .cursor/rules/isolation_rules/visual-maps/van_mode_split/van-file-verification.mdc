---
description: VAN æ¨¡å¼æ–‡ä»¶éªŒè¯çš„å¯è§†åŒ–æµç¨‹å›¾
globs: van-file-verification.mdc
alwaysApply: false
---
# ä¼˜åŒ–çš„æ–‡ä»¶éªŒè¯ç³»ç»Ÿ

ğŸš¨ å…³é”®ï¼šå¿…é¡»è¿›è¡Œè®°å¿†åº“éªŒè¯ ğŸš¨
åœ¨ä»»ä½•æ–‡ä»¶æ“ä½œä¹‹å‰ï¼Œè®°å¿†åº“ç»“æ„å¿…é¡»å­˜åœ¨
æ­¤æ£€æŸ¥å¿…é¡»åœ¨æ‰€æœ‰éªŒè¯è¿‡ç¨‹ä¸­é¦–å…ˆæ‰§è¡Œ

> **ç®€è¿°ï¼š** æ­¤ç³»ç»Ÿæä¾›äº†ä¸€ç§ç»“æ„åŒ–æ–¹æ³•ï¼Œç”¨äºåœ¨ä»»åŠ¡å®æ–½ä¹‹å‰éªŒè¯æ–‡ä»¶ç»“æ„å®Œæ•´æ€§ï¼Œé‡ç‚¹å…³æ³¨é«˜æ•ˆæ£€æŸ¥å’Œæ¸…æ™°çš„çŠ¶æ€æŠ¥å‘Šã€‚

## ğŸ” æ–‡ä»¶éªŒè¯å·¥ä½œæµç¨‹

```mermaid
graph TD
    %% å…³é”®è®°å¿†åº“éªŒè¯ - å¿…é¡»é¦–å…ˆæ‰§è¡Œ
    Start["å¼€å§‹æ–‡ä»¶éªŒè¯"] --> MemBankCheck{"è®°å¿†åº“<br>å­˜åœ¨ï¼Ÿ"}
    MemBankCheck -->|"å¦"| CreateMemBank["åˆ›å»ºè®°å¿†åº“<br>[å…³é”®]"]
    MemBankCheck -->|"æ˜¯"| VerifyMemBankComplete["éªŒè¯è®°å¿†åº“<br>ç»“æ„å®Œæ•´"]
    CreateMemBank --> VerifyMemBankComplete

    VerifyMemBankComplete --> PassCheck{"æ‰€æœ‰å…³é”®<br>æ£€æŸ¥é€šè¿‡ï¼Ÿ"}
    PassCheck -->|"å¦"| AbortAll["â›” ä¸­æ­¢æ‰€æœ‰æ“ä½œ<br>å…ˆä¿®å¤è®°å¿†åº“"]
    PassCheck -->|"æ˜¯"| MainVerification

    %% å¸¸è§„éªŒè¯æµç¨‹ä»è¿™é‡Œç»§ç»­
    MainVerification["å¼€å§‹å®Œæ•´<br>æ–‡ä»¶éªŒè¯"] --> BatchVerify["ä½¿ç”¨æ¨¡å¼<br>æ‰¹é‡éªŒè¯"]
    BatchVerify --> BrokenLinks["æ£€æŸ¥<br>æŸåçš„å¼•ç”¨"]
    BrokenLinks --> DirectoryStructure["éªŒè¯ç›®å½•<br>ç»“æ„"]
    DirectoryStructure --> Status{"æ‰€æœ‰éªŒè¯<br>æˆåŠŸï¼Ÿ"}

    Status -->|"æ˜¯"| Complete["éªŒè¯<br>å®Œæˆ âœ“"]
    Status -->|"å¦"| Diagnose["è¯Šæ–­<br>é—®é¢˜"]
    Diagnose --> Attempt{"å°è¯•è‡ªåŠ¨<br>ä¿®å¤ï¼Ÿ"}

    Attempt -->|"æ˜¯"| AutoFix["è‡ªåŠ¨ä¿®å¤<br>é—®é¢˜"]
    Attempt -->|"å¦"| ReportIssue["å‘ç”¨æˆ·æŠ¥å‘Š<br>é—®é¢˜"]

    AutoFix --> Recheck{"é—®é¢˜<br>å·²è§£å†³ï¼Ÿ"}
    Recheck -->|"æ˜¯"| ReportSuccess["å‘ç”¨æˆ·æŠ¥å‘Š<br>æˆåŠŸ"]
    Recheck -->|"å¦"| ReportIssue

    ReportSuccess --> Complete
    ReportIssue --> UserAction["ç­‰å¾…<br>ç”¨æˆ·æ“ä½œ"]
    UserAction --> ReVerify["ç”¨æˆ·æ“ä½œå<br>é‡æ–°éªŒè¯"]
    ReVerify --> Status

    style MemBankCheck fill:#ff0000,stroke:#990000,color:white,stroke-width:3px
    style CreateMemBank fill:#ff0000,stroke:#990000,color:white,stroke-width:3px
    style VerifyMemBankComplete fill:#ff0000,stroke:#990000,color:white,stroke-width:3px
    style PassCheck fill:#ff0000,stroke:#990000,color:white,stroke-width:3px
    style AbortAll fill:#ff0000,stroke:#990000,color:white,stroke-width:3px
    style Status fill:#f6546a,stroke:#c30052,color:white
    style Complete fill:#10b981,stroke:#059669,color:white
```

## ğŸ§© è®°å¿†åº“éªŒè¯ - å…³é”®ç»„ä»¶

è®°å¿†åº“éªŒè¯å¿…é¡»åœ¨ä»»ä½•æ–‡ä»¶éªŒè¯è¿‡ç¨‹ä¸­é¦–å…ˆæ‰§è¡Œï¼š

```javascript
function verifyMemoryBank() {
  // æ£€æŸ¥è®°å¿†åº“æ˜¯å¦å­˜åœ¨
  const memoryBankExists = checkDirectoryExists("memory-bank");
  if (!memoryBankExists) {
    console.error("â›” å…³é”®é”™è¯¯ï¼šè®°å¿†åº“ä¸å­˜åœ¨");
    createMemoryBankStructure();
    return verifyMemoryBankCreation();
  }

  // æ£€æŸ¥å¿…éœ€çš„å­ç›®å½•
  const requiredDirs = [
    "memory-bank/active-context",
    "memory-bank/system-patterns",
    "memory-bank/creative-phase",
    "memory-bank/implementation"
  ];

  const missingDirs = requiredDirs.filter(dir => !checkDirectoryExists(dir));
  if (missingDirs.length > 0) {
    console.error(`â›” å…³é”®é”™è¯¯ï¼šç¼ºå°‘è®°å¿†åº“ç›®å½•ï¼š${missingDirs.join(", ")}`);
    createMissingDirectories(missingDirs);
    return verifyMemoryBankCreation();
  }

  // æ£€æŸ¥å…³é”®æ–‡ä»¶
  const criticalFiles = [
    "memory-bank/active-context/activeContext.md",
    "memory-bank/system-patterns/systemPatterns.md"
  ];

  const missingFiles = criticalFiles.filter(file => !checkFileExists(file));
  if (missingFiles.length > 0) {
    console.error(`â›” å…³é”®é”™è¯¯ï¼šç¼ºå°‘å…³é”®æ–‡ä»¶ï¼š${missingFiles.join(", ")}`);
    createMissingFiles(missingFiles);
    return verifyMemoryBankCreation();
  }

  return true; // è®°å¿†åº“éªŒè¯æˆåŠŸ
}

// å¼ºåˆ¶ï¼šå¿…é¡»åœ¨ä»»ä½•å…¶ä»–éªŒè¯ä¹‹å‰è°ƒç”¨æ­¤å‡½æ•°
const memoryBankVerified = verifyMemoryBank();
if (!memoryBankVerified) {
  throw new Error("â›” è®°å¿†åº“éªŒè¯å¤±è´¥ - æ— æ³•ç»§ç»­");
}
```

## ğŸ“‹ è®°å¿†åº“éªŒè¯æ£€æŸ¥æ¸…å•

```
âœ“ è®°å¿†åº“éªŒè¯æ£€æŸ¥æ¸…å•
- è®°å¿†åº“ç›®å½•å­˜åœ¨ï¼Ÿ[æ˜¯/å¦]
- å¿…éœ€çš„å­ç›®å½•å­˜åœ¨ï¼Ÿ[æ˜¯/å¦]
- å…³é”®æ–‡ä»¶å­˜åœ¨ï¼Ÿ[æ˜¯/å¦]
- æ–‡ä»¶å†…å®¹æœ‰æ•ˆï¼Ÿ[æ˜¯/å¦]

â†’ å¦‚æœå…¨éƒ¨ä¸ºæ˜¯ï¼šè®°å¿†åº“éªŒè¯é€šè¿‡ - ç»§ç»­æ–‡ä»¶éªŒè¯
â†’ å¦‚æœæœ‰å¦ï¼šåœæ­¢æ‰€æœ‰å¤„ç†å¹¶ä¿®å¤è®°å¿†åº“
```

## ğŸ” æ‰¹é‡éªŒè¯å·¥ä½œæµç¨‹

## ğŸ“‹ ä¼˜åŒ–çš„ç›®å½•åˆ›å»º

```mermaid
graph TD
    Start["ç›®å½•<br>åˆ›å»º"] --> DetectOS["æ£€æµ‹æ“ä½œ<br>ç³»ç»Ÿ"]
    DetectOS -->|"Windows"| WinCmd["æ‰¹é‡åˆ›å»º<br>Windows å‘½ä»¤"]
    DetectOS -->|"Mac/Linux"| UnixCmd["æ‰¹é‡åˆ›å»º<br>Unix å‘½ä»¤"]
    WinCmd & UnixCmd --> Verify["éªŒè¯<br>åˆ›å»ºæˆåŠŸ"]
    Verify --> Complete["ç›®å½•è®¾ç½®<br>å®Œæˆ"]
```

### å¹³å°ç‰¹å®šå‘½ä»¤

#### Windows (PowerShell)
```powershell
# ä¸€æ¬¡å‘½ä»¤åˆ›å»ºæ‰€æœ‰ç›®å½•
mkdir memory-bank, docs, docs\archive -ErrorAction SilentlyContinue

# åˆ›å»ºæ‰€æœ‰å¿…éœ€æ–‡ä»¶
$files = @(".cursorrules", "tasks.md",
           "memory-bank\projectbrief.md",
           "memory-bank\productContext.md",
           "memory-bank\systemPatterns.md",
           "memory-bank\techContext.md",
           "memory-bank\activeContext.md",
           "memory-bank\progress.md")

foreach ($file in $files) {
    if (-not (Test-Path $file)) {
        New-Item -Path $file -ItemType File -Force
    }
}
```

#### Mac/Linux (Bash)
```bash
# ä¸€æ¬¡å‘½ä»¤åˆ›å»ºæ‰€æœ‰ç›®å½•
mkdir -p memory-bank docs/archive

# åˆ›å»ºæ‰€æœ‰å¿…éœ€æ–‡ä»¶
touch .cursorrules tasks.md \
      memory-bank/projectbrief.md \
      memory-bank/productContext.md \
      memory-bank/systemPatterns.md \
      memory-bank/techContext.md \
      memory-bank/activeContext.md \
      memory-bank/progress.md
```

## ğŸ“ ç²¾ç®€çš„éªŒè¯æµç¨‹

ä¸è¦å•ç‹¬æ£€æŸ¥æ¯ä¸ªç»„ä»¶ï¼Œè€Œæ˜¯æ‰§è¡Œæ‰¹é‡éªŒè¯ï¼š

```powershell
# Windows - PowerShell
$requiredDirs = @("memory-bank", "docs", "docs\archive")
$requiredFiles = @(".cursorrules", "tasks.md")
$mbFiles = @("projectbrief.md", "productContext.md", "systemPatterns.md",
             "techContext.md", "activeContext.md", "progress.md")

$missingDirs = $requiredDirs | Where-Object { -not (Test-Path $_) -or -not (Test-Path $_ -PathType Container) }
$missingFiles = $requiredFiles | Where-Object { -not (Test-Path $_) -or (Test-Path $_ -PathType Container) }
$missingMBFiles = $mbFiles | ForEach-Object { "memory-bank\$_" } |
                  Where-Object { -not (Test-Path $_) -or (Test-Path $_ -PathType Container) }

if ($missingDirs.Count -eq 0 -and $missingFiles.Count -eq 0 -and $missingMBFiles.Count -eq 0) {
    Write-Output "âœ“ æ‰€æœ‰å¿…éœ€ç»„ä»¶å·²éªŒè¯"
} else {
    # ä¸€æ¬¡åˆ›å»ºæ‰€æœ‰ç¼ºå¤±é¡¹
    if ($missingDirs.Count -gt 0) {
        $missingDirs | ForEach-Object { mkdir $_ -Force }
    }
    if ($missingFiles.Count -gt 0 -or $missingMBFiles.Count -gt 0) {
        $allMissingFiles = $missingFiles + $missingMBFiles
        $allMissingFiles | ForEach-Object { New-Item -Path $_ -ItemType File -Force }
    }
}
```

## ğŸ“ æ¨¡æ¿åˆå§‹åŒ–

ä½¿ç”¨å•ä¸ªè„šæœ¬ä¼˜åŒ–æ¨¡æ¿åˆ›å»ºï¼š

```powershell
# Windows - PowerShell
$templates = @{
    "tasks.md" = @"
# è®°å¿†åº“ï¼šä»»åŠ¡

## å½“å‰ä»»åŠ¡
[ä»»åŠ¡å°šæœªå®šä¹‰]

## çŠ¶æ€
- [ ] ä»»åŠ¡å®šä¹‰
- [ ] å®æ–½è®¡åˆ’
- [ ] æ‰§è¡Œ
- [ ] æ–‡æ¡£

## éœ€æ±‚
[å°šæœªå®šä¹‰éœ€æ±‚]
"@

    "memory-bank\activeContext.md" = @"
# è®°å¿†åº“ï¼šæ´»åŠ¨ä¸Šä¸‹æ–‡

## å½“å‰ç„¦ç‚¹
[æœªå®šä¹‰æ´»åŠ¨ç„¦ç‚¹]

## çŠ¶æ€
[æœªå®šä¹‰çŠ¶æ€]

## æœ€æ–°æ›´æ”¹
[æœªè®°å½•æ›´æ”¹]
"@

    # åœ¨æ­¤æ·»åŠ å…¶ä»–æ¨¡æ¿
}

foreach ($file in $templates.Keys) {
    if (Test-Path $file) {
        Set-Content -Path $file -Value $templates[$file]
    }
}
```

## ğŸ” æ€§èƒ½ä¼˜åŒ–æœ€ä½³å®è·µ

1. **æ‰¹é‡æ“ä½œ**ï¼šå§‹ç»ˆä½¿ç”¨æ‰¹é‡æ“ä½œè€Œä¸æ˜¯å•ä¸ªå‘½ä»¤
   ```
   # å¥½ï¼šä¸€æ¬¡åˆ›å»ºæ‰€æœ‰ç›®å½•
   mkdir memory-bank docs docs\archive

   # å·®ï¼šä¸€æ¬¡åˆ›å»ºä¸€ä¸ªç›®å½•
   mkdir memory-bank
   mkdir docs
   mkdir docs\archive
   ```

2. **é¢„æ£€æŸ¥ä¼˜åŒ–**ï¼šå…ˆæ£€æŸ¥æ‰€æœ‰éœ€æ±‚ï¼Œç„¶ååªåˆ›å»ºç¼ºå¤±çš„å†…å®¹
   ```
   # é¦–å…ˆæ£€æŸ¥ç¼ºå¤±çš„å†…å®¹
   $missingItems = ...

   # ç„¶ååªåˆ›å»ºç¼ºå¤±çš„å†…å®¹
   if ($missingItems) { ... }
   ```

3. **é”™è¯¯å¤„ç†**ï¼šåœ¨æ‰€æœ‰å‘½ä»¤ä¸­åŒ…å«é”™è¯¯å¤„ç†
   ```
   mkdir memory-bank, docs, docs\archive -ErrorAction SilentlyContinue
   ```

4. **å¹³å°é€‚é…**ï¼šè‡ªåŠ¨æ£€æµ‹å¹³å°å¹¶ä½¿ç”¨é€‚å½“çš„å‘½ä»¤
   ```
   if ($IsWindows) {
       # Windows å‘½ä»¤
   } else {
       # Unix å‘½ä»¤
   }
   ```

5. **å•æ¬¡éªŒè¯**ï¼šåœ¨å•æ¬¡éå†ä¸­éªŒè¯ç›®å½•ç»“æ„
   ```
   $requiredPaths = @("memory-bank", "docs", "docs\archive", ".cursorrules", "tasks.md")
   $missingPaths = $requiredPaths | Where-Object { -not (Test-Path $_) }
   ```

## ğŸ“ éªŒè¯æŠ¥å‘Šæ ¼å¼

```
âœ… éªŒè¯å®Œæˆ
- å·²åˆ›å»ºç›®å½•ï¼š[åˆ—è¡¨]
- å·²åˆ›å»ºæ–‡ä»¶ï¼š[åˆ—è¡¨]
- æ‰€æœ‰ç»„ä»¶å·²éªŒè¯

è®°å¿†åº“ç³»ç»Ÿå·²å‡†å¤‡å°±ç»ªã€‚
```
